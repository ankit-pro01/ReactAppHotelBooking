var LANGUAGE = document.documentElement.lang;
var deviceType = (!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) ? 'desktop': 'mobile';
$(document).ready(function() {
           var s = $(".skiner");
           var pos = s.position();            
           $(window).scroll(function() {
             var windowpos = $(window).scrollTop();
             if (windowpos >= pos.top && windowpos <=90000) {
               s.addClass("stick");
             } else {
               s.removeClass("stick"); 
             }
           });

          $(".varientP").change(function(){
          var selectedVariant = $(this).children("option:selected").val();
          window.location.href = selectedVariant;
          });
           

           $('.soc-class').click(function(){
                    
                    var url=$(this).attr('data-url');
                    $.ajax({
    type: "GET",
    url: url
}).done(function( msg ) {
    alert( msg );
});

                });

$('.r-star').click(function(){

hidecolor();


    var star=$(this).attr('value');
    $("#hid-rating").val(star);
    
    colorclass=getStarColor(star);

$('.r-star').each(function(index) {
    if(index<star)
    {
      $(this).addClass(colorclass);
    }
  });
});

if(reviewpopupflag)
{
  $('html, body').animate({
        scrollTop: $("#user_review").offset().top
    }, 2000);
  $("#myReview").modal('show');
}


/*
 * *****************************************************
 * This is for gloabal search
 *******************************************************
 */
$(document).on('keydown', '#globalPageSearchText', function (e) {
    if (e.which == 13) {
        searchOnDigit();
    }
});


         });
         

         /* 
 * **************************************************************************
 * Method Name      :   searchOnDigit
 * Description      :   This is to validate and redirect global search to DIGIT 
 *                      main search URL
 * **************************************************************************
 */
function searchOnDigit() {
    var searchKeyword = $('#globalPageSearchText').val();
    searchKeyword = $.trim(searchKeyword);
    if (searchKeyword == '') {
        alert('Please enter some text to search.');
        return false;
    }
    let srchLocale = LANGUAGE == 'en' ? '' : `${LANGUAGE}/`;
    let srcUrl = `https://www.digit.in/${srchLocale}search/?keyword=${searchKeyword}`;
    window.location = srcUrl;
}
         function hidecolor()
         {
          $('.Star-review').find('.r-star').removeClass('redtext');
$('.Star-review').find('.r-star').removeClass('yellowtext');
$('.Star-review').find('.r-star').removeClass('greentext');
         }
    function getStarColor(star)
      {

          if(star>=1 && star<=2)
          {
            colorclass='redtext';
          }else if (star> 2  && star<=4)
          {   
            colorclass='yellowtext';
          }else{
            colorclass='greentext';
          }
    return colorclass;
      }

      function getBarColor(rate)
      {

          if(rate>= 90)
          {
            colorclass='Gree-Rate';
          }else if (rate >= 70 && rate < 90)
          {   
            colorclass='Yello-Rate';
          }else{
            colorclass='Poor-Rate';
          }
    return colorclass;
      }

       function getStarBarColor(rate)
      {
          if(rate==1 || rate==2)
          {
            colorclass='Poor-Rate';
          }else if(rate==3 || rate==4)
          {
            colorclass='Yello-Rate';
          }else{
            colorclass='Gree-Rate';
          }
      return colorclass;
      }

         function submitReview()
         {
          var rating=$("#hid-rating").val();
          var username=$("#hid-username").val();
          var name=$("#hid-name").val();
          var path=$("#hid-path").val();
          var user_id=$("#hid-user_id").val();
          var model_id=$("#hid-model_id").val();
          var heading=$("#title").val();
          var description=$("#description").val();
          var formattedDate = new Date();
          let formatted_date = formattedDate.getDate() + "-" + (formattedDate.getMonth() + 1) + "-" + formattedDate.getFullYear()+ "  "+ formattedDate.getHours()+":"+formattedDate.getMinutes()+":"+formattedDate.getSeconds();

heading = heading.replace(/<[^>]+>/g, '');
description = description.replace(/<[^>]+>/g, '');

if(rating=='')
{
  alert("Kindly give the rating");
  return false;
}else if(heading=='')
{
  alert("Please write the title");
  return false;
}else if(heading.length>200)
{
  alert("Title should be less than 200 characters");
  return false;
}else if(description.length>200)
{
  alert("Description should be less than 200 characters");
  return false;
}

heading1 = heading.toLowerCase();
description1 = description.toLowerCase();

badwords.forEach(function(item){
  if(heading1.indexOf(item)!= -1)
  {
    alert("No bad words are allowed in title and review");
  return false;
  }
  if(description1.indexOf(item)!= -1)
  {
    alert("No bad words are allowed in title and review");
  return false;
  }
});

var urlpost=digitApiUrl+"userreview/review_post?model_id="+model_id+"&title="+heading+"&description="+description+"&merchant_username="+name+"&merchant_user_image="+path+"&merchant_rating="+rating+"&user_id="+user_id+"&date="+formatted_date;

           $.ajax({
    type: "GET",
    url: urlpost
}).done(function( msg ) {
  
    setTimeout(function () { window.location.reload(true); }, 100);
});

         }
 function openNav() {
           document.getElementById("mySidenav").style.width = "350px";
           document.getElementById("main").style.marginLeft = "0";
           document.body.style.backgroundColor = "rgba(0,0,0,0.4)";
            var element = document.body;
           element.classList.add("open-menu");
         }
         
         function closeNav() {
           document.getElementById("mySidenav").style.width = "0";
           document.getElementById("main").style.marginLeft= "0";
           document.body.style.backgroundColor = "#fff";
           var element = document.body;
           element.classList.remove("open-menu");
         }        


         $(document).ready(function(){

    $('.customer-logos').slick({
        slidesToShow: 2,
        slidesToScroll: 2,
        autoplay: true,
        autoplaySpeed:2500,
        arrows: true,
        dots: false,
        pauseOnHover: false,
        responsive: [{
            breakpoint: 768,
            settings: {
                slidesToShow: 2
            }
        }, {
            breakpoint: 520,
            settings: {
                slidesToShow: 1,
                centerMode: true,
                  centerPadding: '42px'
            }
        }]
    });

  $('.News-crousel').slick({
        slidesToShow:4,
        slidesToScroll:1,
        autoplay:false,
        autoplaySpeed:2900,
        arrows: true,
        dots: false,
        pauseOnHover: false,
        responsive: [{
            breakpoint: 768,
            settings: {
                slidesToShow: 3
            }
        }, {
            breakpoint: 520,
            settings: {
                slidesToShow: 1.5,
                 centerPadding: '42px'
                    
        
            }
        }]
    });
    $('.Recent-View').slick({
        slidesToShow:4,
        slidesToScroll: 1,
        autoplay: false,
        autoplaySpeed:2900,
        arrows: true,
        dots: false,
        pauseOnHover: false,
        responsive: [{
            breakpoint: 768,
            settings: {
                slidesToShow: 3
            }
        }, {
            breakpoint: 520,
            settings: {
                slidesToShow: 1.5,
               centerPadding: '42px'
            }
        }]
    });
        $('.Product-news').slick({
        slidesToShow:4,
        slidesToScroll: 1,
        autoplay: false,
        autoplaySpeed:2900,
        arrows: true,
        dots: false,
        pauseOnHover: false,
        responsive: [{
            breakpoint: 768,
            settings: {
                slidesToShow: 3
            }
        }, {
            breakpoint: 520,
            settings: {
                slidesToShow: 1.5,
                 centerPadding: '42px'
            }
        }]
    });

});

(function($){
$(document).ready(function(){

$('#cssmenu li.active').addClass('open').children('ul').show();
    $('#cssmenu li.has-sub>b').on('click', function(){
        $(this).removeAttr('href');
        var element = $(this).parent('li');
        if (element.hasClass('open')) {
            element.removeClass('open');
            element.find('li').removeClass('open');
            element.find('ul').slideUp(200);
        }
        else {
            element.addClass('open');
            element.children('ul').slideDown(200);
            element.siblings('li').children('ul').slideUp(200);
            element.siblings('li').removeClass('open');
            element.siblings('li').find('li').removeClass('open');
            element.siblings('li').find('ul').slideUp(200);
        }
    });


      if ($("#StikyHeader").is(":visible")) {
         document.getElementById("StikyHeader").style.display= "none";
         window.onscroll = function() {myFunction()};
         
         var StikyHeader = document.getElementById("StikyHeader");
         var TopFixed = StikyHeader.offsetTop;
         function myFunction() {
          
           if (window.pageYOffset >= TopFixed+60) {
             // StikyHeader.classList.add("TopFixed")
              document.getElementById("StikyHeader").setAttribute("style","position:fixed;top:0;display:block;");

           } else {
            // StikyHeader.classList.remove("TopFixed");
            document.getElementById("StikyHeader").style.display= "none";
           }
         }
        }


});
})(jQuery);
 
 // vertical Tab

function openCity(evt, cityName) {
  var i, tabcontent, tablinks;
  tabcontent = document.getElementsByClassName("tabcontent");
  for (i = 0; i < tabcontent.length; i++) {
    tabcontent[i].style.display = "none";
  }
  tablinks = document.getElementsByClassName("tablinks");
  for (i = 0; i < tablinks.length; i++) {
    tablinks[i].className = tablinks[i].className.replace(" active", "");
  }
  document.getElementById(cityName).style.display = "block";
  evt.currentTarget.className += " active";
}

// Get the element with id="defaultOpen" and click on it
if(document.getElementById("defaultOpen"))
document.getElementById("defaultOpen").click();
 //Vertical Tab End


function MoreLink_RevealMore(){
   document.getElementById("MoreLink_fade-out-div").style.display = "none";
   var h = document.getElementById("MoreLink_content-container");
   h.style.height = h.scrollHeight + "px";
}

var mybutton = document.getElementById("myBtn");
if(mybutton){
// When the user scrolls down 20px from the top of the document, show the button
window.onscroll = function() {scrollFunction()};

function scrollFunction() {
  if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
    mybutton.style.display = "block";
  } else {
    mybutton.style.display = "none";
  }
}
}
// When the user clicks on the button, scroll to the top of the document
function topFunction() {
  document.body.scrollTop = 0;
  document.documentElement.scrollTop = 0;
}


/************** This is to load image On Scroll for Home Page **********/
$(document).ready(function() {

    if(current_route && (current_route == 'home' || current_route == 'varnacHome' || current_route == 'toptenDetail' || current_route == 'toptenDetailVrnc' || current_route == 'article' || current_route == 'articleVernac' || current_route == 'brandlisting.vernac' || current_route == 'brandlisting' || current_route == 'nonampproduct'))
    {
        if ($(".desktop_top_banner").is(":visible")) { 
            $(".desktop_top_banner").attr("src",$(".desktop_top_banner").attr("data-src"));
        }
        if ($(".lazyimage").is(":visible")) {
            $(window).scroll(function () {
              updateImageSrc();
            });
        }else if($("img.article-lazyimage").length >0) {
          $(window).scroll(function () {updateImageSrcBySelector('img.article-lazyimage');});
          updateImageSrc();
        }else{
              updateImageSrc();
        }
    }else{
       updateImageSrc();
    }

    $(window).scroll(function () {
        /************** This is to load video frame **********/
            if ($("#top10VideoThumbnail").is(":visible")) {
               loadtop10VideoSection();
           }
           /***************************************/
    });

    $(".top10VideoThumbnailGallery").click(function(){
        top10VideoThumbnailGallery();
      });

});

/************** End **********/

/* 
 * *****************************************************************************
 * Method Name      :   updateImageSrc
 * Description      :   This is to update image src with data-src url
 * *****************************************************************************
 */
  function updateImageSrc() {
      $('img').each(function( index ) {
        let dataSrc = $(this).attr('data-src') || '';
        if(dataSrc != '' && !$(this).hasClass('article-lazyimage'))
            $(this).attr('src',dataSrc);
      });
  }
  function updateImageSrcBySelector(selector) {

      $(selector).each(function( index ) {
        let dataSrc = $(this).attr('data-src');
        $(this).attr('src',dataSrc);
      });
  }

function getMerchantReview(sessionflag)
{
var id=$("#hid-product").val();
var pageUrl=$("#hid-url").val();
var merchant=$("#merchant_review").children("option:selected").val();
if(merchant!='all')
url =pageUrl+'&merchant='+merchant;
else
url=pageUrl;

  $.ajax({
        type: 'GET',
        url: digitApiUrl+'userreview/userreviewlist',
        dataType: '',
        data: {
            id: id,
            start: 0,
            limit: 10,
            merchant: merchant,
        },
        beforeSend: function (request) {
            return request.setRequestHeader('X-CSRF-Token', $("meta[name='token']").attr('content'));
        },
        success: function (data) {
            if (data.success == true) {
                var bucketArray=data.data.total_per_rating.buckets;
                bucketArray.sort(function(a, b) {
    return a['key'] < b['key'] ? 1 : a['key'] > b['key'] ? -1 : 0
  });

var rate_sum=0;
bucketArray.forEach(function(buckets) {
                          rate_sum=rate_sum+(buckets.key * buckets.doc_count);
                        });
if(rate_sum!=0)
{
  var avg=Math.round(rate_sum/data.data.hits.total*10)/10;
}else{
  var avg=0;
}


                var reviewArray=data.data.hits.hits;

                colorclass=getStarColor(avg);
                let innerhtml=`<h2>user review</h2><div class="Review-wraper">
        <div class="row">
            <div class="col-md-4">
                <div class="Over-allrating">
                    <div class="User-Coment"> Overall Rating </div>
                    <div class="UserDate ${colorclass}">${avg}/ <sub>5 </sub> </div>
                    <span style="float:left;width:100%;text-align:left;margin:21px 0 9px 16px;">`;
                    var i=1;
                    
                            while(i<=avg)
                            {
                              innerhtml +=`<i class="fa fa-star ${colorclass}"></i>`;
                              i++;
                            }
                            if(!Number.isInteger(avg))
                            {
                              innerhtml +=`<i class="fa fa-star-half-o ${colorclass}" aria-hidden="true"></i>`;
                            }
                            var j=1;
                            while(j<=5-(avg))
                            {
                              innerhtml +=`<i class="fa fa-star" style="color:#d2d2d2;"></i>`;
                              j++;
                            }
                        

                        innerhtml +=`</span>
                    <div class="Basedon"> Based on <b> ${data.data.hits.total} </b>Rating </div>
                    <div class="Rating-Review">
                        <ul>`;
                        bucketArray.forEach(function(buckets) {
                          per=((buckets.doc_count)/(data.data.hits.total))*100;
                          barColor=getStarBarColor(buckets.key);
                          innerhtml +=`<li>
                                <span>${buckets.key} star </span>
                                <p> ${buckets.doc_count}</p>
                                <div class="progress">
                                    <div class="progress-bar ${barColor}" style="width:${per}%"></div>
                                </div>
                            </li>`;
                        });

                       innerhtml +=` </ul>
                    </div>
<div class="Basedon"> Based on <b> ${data.data.hits.total}</b> Rating </div>
                    <div class="Writ-review">
                        <h5> Write your riview</h5>`;
                        if(sessionflag)
                        innerhtml +=`<p> <a href="#" data-toggle="modal" data-target="#myReview">write review</a>  </p>`;
                      else
                        innerhtml +=`<p> <a href="#" data-toggle="modal" data-target="#myLogin">write review</a>  </p>`;
                    
                    innerhtml +=`</div>
                    </div>
            </div>
            <div class="col-md-8">
                <div class="User-review-list">
                    <h3> user review</h3>
                    <div class="Select-Review">
                        <select class="form-control" id="merchant_review" onchange="getMerchantReview(${sessionflag})">
                            <option value="all" `;
                            if(merchant=='all')
                              innerhtml +=`selected`;
                            innerhtml +=`>All Review</option>
                            <option value="amazon" `;
                            if(merchant=='amazon')
                              innerhtml +=`selected`;
                            innerhtml +=`>Amazon</option>
                            <option value="flipkart" `;
                            if(merchant=='flipkart')
                              innerhtml +=`selected`;
                            innerhtml +=`>Flipkart</option>
                            <option value="user"`;
                            if(merchant=='user')
                              innerhtml +=`selected`;
                            innerhtml +=`>Digit</option>
                        </select>
                        <input type="hidden" name="hid-product" id="hid-product" value="${id}">
                        <input type="hidden" name="hid-url" id="hid-url" value="${pageUrl}">
                    </div>
                    <ul>`;
                    reviewArray.forEach(function(reviews) {
                      var formattedDate = new Date(reviews._source.created);
                      let formatted_date = formattedDate.getDate() + "-" + (formattedDate.getMonth() + 1) + "-" + formattedDate.getFullYear();
                          colorclass=getStarColor(reviews._source.merchant_rating);
                          innerhtml +=`<li>
                            <h6>${reviews._source.title} </h6>
                            <div class="List-star">`;
                            var i=1;
                            while(i<=reviews._source.merchant_rating)
                            {
                              innerhtml +=`<i class="fa fa-star ${colorclass}"></i>`;
                              i++;
                            }
                            var j=1;
                            while(j<=5-(reviews._source.merchant_rating))
                            {
                              innerhtml +=`<i class="fa fa-star" style="color:#d2d2d2;"></i>`;
                              j++;
                            }
                            innerhtml +=`</div>
                            <span> ${reviews._source.merchant_username} `;
                            if(reviews._source.created_by=='user')
                              innerhtml +=`on Digit.in`;
                            else if(reviews._source.created_by=='Flipkart')
                              innerhtml +=`on ${reviews._source.created_by}.com`;
                            else if(reviews._source.created_by=='Amazon')
                              innerhtml +=`on ${reviews._source.created_by}.in`;

                                innerhtml +=` | ${formatted_date}</span>
                            <p>${reviews._source.description}</p>
                        </li>`;
                        });
                    innerhtml +=`</ul>
                    <a href="${url}" class="more-view"> Click here for more Reviews &gt;</a>
                </div>
            </div>
        </div>
    </div>`;
                $("#user_review").html(innerhtml);
            } else if (data.success == false) {
                alert(data.msg);
            }
        },
        error: function (data) {
            alert('Sorry! We are unable to fetch data. Please try again.');
        }

    });

}

$(document).ready(function(){

    $("#variant-select, #popvariant-select").change(function(){
        let vpid = $(this).val();
        $(".variant-row, .popvariant-row").hide();
        if(vpid != 'all')
          $(`.variant-row.${vpid}, .popvariant-row.${vpid}`).show();
        else
          $(".variant-row, .popvariant-row").show();
        
        if($(this).find(':selected').data('url')){
            window.history.replaceState(null, null, $(this).find(':selected').data('url'));
        }
    })

    if(deviceType === 'mobile'){
      $(".img-wrapper,.UI-pictures div").removeAttr('data-target');
      $(".img-wrapper,.UI-pictures div").click(function(){
        var slideindex2  = $(this).attr("data-url");
        var imgNo  = $(this).attr("data-imgno");
        if ($.isEmptyObject(productName)) {
            var title  = 'Digit_Product_Name';
        } else {
            var title  = productName;
        }
        var slidUrl2 = '#'+slideindex2+'_'+imgNo;
        var dataJson = {hitType: 'event', eventCategory: slideindex2, eventAction: slideindex2+imgNo, eventLabel: title};
          gaTrack(dataJson);
        window.location.href = window.location.href + '?q=photos'+slidUrl2;
      });
            
    $('.myCarousel-digit').on('slid.bs.carousel', function () {
          var sObj = { "state": "Image Slide"};
          var slideindex  =$('#myCarousel div.item.active').index();
          var hash = $(location).attr('hash').replace('#','');
          var hashsxplode=hash.split("_");
          var group=hashsxplode[0];
          var sliUrl = '#'+group+'_'+slideindex;
          window.history.pushState(sObj, "Slider NO", sliUrl);
          if ($.isEmptyObject(productName)) {
            var title  = 'Digit_Product_Name';
        } else {
            var title  = productName;
        }
         var relativeUrl = window.location.href;
          ga('set', 'page', relativeUrl);
          ga('send', 'pageview', relativeUrl);
          self.COMSCORE && COMSCORE.beacon(
              {c1: "2", c2: "9989804"}
          );
      
         // var dataJson = {hitType: 'event', eventCategory: firstelement, eventAction: firstelement+sliderId, eventLabel: title};
         // gaTrack(dataJson);
     })

     $('#videos').on('slid.bs.carousel', function () {
        var sObj = { "state": "Image Slide"};
        var slideindex  =$('#videos div.carousel-item.active').index();
        var hash = $(location).attr('hash').replace('#','');
        var hashsxplode=hash.split("_");
        var group=hashsxplode[0];
        var sliUrl = '#'+group+'_'+slideindex;
        window.history.pushState(sObj, "Slider NO", sliUrl);
        if ($.isEmptyObject(productName)) {
            var title  = 'Digit_Product_Name';
        } else {
            var title  = productName;
        }
        var relativeUrl = window.location.href;
          ga('set', 'page', relativeUrl);
          ga('send', 'pageview', relativeUrl);
          self.COMSCORE && COMSCORE.beacon(
              {c1: "2", c2: "9989804"}
          );
       // var dataJson = {hitType: 'event', eventCategory: firstelement, eventAction: firstelement+sliderId, eventLabel: title};
       // gaTrack(dataJson);
   })

     $("a.digitimage-bucket").click(function(){
        var slideindex1  = $(this).attr("data-url");
        $('#myCarousel div.item.active').removeClass("active");
        var sliderId = '#digitslider_'+slideindex1+'_0';
        $(sliderId).addClass("active"); 
        var sliUrl1 = '#'+slideindex1+'_0';
        var sObj1 = { "state": "Image Slide"};
        window.history.pushState(sObj1, "Slider NO", sliUrl1);
        if ($.isEmptyObject(productName)) {
            var title  = 'Digit_Product_Name';
        } else {
            var title  = productName;
        }
        var dataJson = {hitType: 'event', eventCategory: slideindex1, eventAction: slideindex1+'_0', eventLabel: title};
        gaTrack(dataJson);
      });


    $(".digitimage-bucket").removeClass("active");
    var hash =  $(location).attr('hash').replace('#','');
    var hashsxplode=hash.split("_");
    var firstelement=hashsxplode[0];
    var item_number=hashsxplode[1];
    if(firstelement && item_number){
    $("#nav-"+firstelement+"-tab").addClass("active");
    var sliderId = '#digitslider_'+firstelement+'_'+item_number;
    var sliderthumbId = '#digitsliderthumb_'+firstelement+'_'+item_number;
    $('#myCarousel div.item.active').removeClass("active");
    $(sliderId).addClass("active"); 
    $('#myCarousel div.list-inline-item ').removeClass("active");
    $(sliderthumbId).addClass("active"); 
    $(sliderthumbId).addClass("active");
    $('.digittab-pane').removeClass("show active");
    $("#nav-"+firstelement).addClass("show active");
    }
   }
  
   if(deviceType === 'desktop'){
    $(".UI-pictures div").click(function(){
      var slideindex2  = $(this).attr("data-url"); console.log(slideindex2);
      var imgNo  = ($(this).attr("data-imgno"))?$(this).attr("data-imgno"):0;
      $('div.Light-tab #nav-tab a.nav-item.active').removeClass("active");
      $('div.Light-tab #nav-tabContent div.mobilegallery.active').removeClass("active");
      if(slideindex2=='videos'){
        $('div.Light-tab #nav-video-tab').addClass("active");
        $('div.Light-tab #nav-video').addClass("active show");
      }else{
      $('div.Light-tab #pills-'+slideindex2+'-tab').addClass("active");
      $('div.Light-tab #pills-'+slideindex2).addClass("active show");
      }
      if ($.isEmptyObject(productName)) {
          var title  = 'Digit_Product_Name';
      } else {
          var title  = productName;
      }
      var dataJson = {hitType: 'event', eventCategory: slideindex2, eventAction: slideindex2+imgNo, eventLabel: title};
        gaTrack(dataJson);
        
    });
   }

$('#nav-tabContent').on('slid.bs.carousel', function () {
   // var eventCategory = 'GalleryPopopImage';
  //  var eventAction = productName+'_PopSliderClick_'+$(this).data('group_name');
   //  var eventLabel = productName+'_image_no_'+$(this).data('img-no');
    // var dataJson = {hitType: 'event', eventCategory: eventCategory, eventAction: eventAction, eventLabel: eventLabel};
   //  gaTrack(dataJson);
     var hrefLink = $('.carousel-control-prev').attr("href");
     var relativeUrl = window.location.href+hrefLink;
    // console.log(relativeUrl);
     ga('set', 'page', relativeUrl);
     ga('send', 'pageview', relativeUrl);
     self.COMSCORE && COMSCORE.beacon(
        {c1: "2", c2: "9989804"}
    );
})

$("#nav-tab a.nav-item, #slideshow div.img-wrapper,.UI-pictures div").click(function(){
    var hrefLink = ($(this).attr("href"))?$(this).attr("href"):'#'+$(this).attr("data-url");
    var relativeUrl = window.location.href+hrefLink+'-0';
  //  console.log(relativeUrl);
    ga('set', 'page', relativeUrl);
    ga('send', 'pageview', relativeUrl);
    self.COMSCORE && COMSCORE.beacon(
        {c1: "2", c2: "9989804"}
    );
})

});

/************** START: Copy Old Js (common.js) File Content  for product **********/

if ($("#display_headerAd").is(":visible")) {
    headerAd();
}

$('.merchantBuyBtn, a.merchantBuyBtn, tr.merchantBuyBtn').on('click',merchantGaAffliateEvent);

/* redirect Data Href link */

jQuery(document).ready(function() {

    $(".datahreflink,a.datahreflink,span.datahreflink,div.datahreflink").click(function() {
     linkurl = $(this).attr('data-href');
      window.open(linkurl,"_self");
  });
    
/* redirect Merchant Data Href link */

    $(".merchantlink").click(function() {
     linkurl = $(this).attr('data-href');
      if(typeof linkurl !== typeof undefined && linkurl !== false) {
      window.open(linkurl);
      }
  });

});

/* 
 * **************************************************************************
 * Method Name      :   showPriceDropdownAlert
 * Description      :   To open price drop alert pop up and set/reset default 
 *                      values.
 * **************************************************************************
 */
function showPriceDropdownAlert(productId, digitPrice, lowestPrice) {
    var productName = $('#productName' + productId).val();
    var productLang = $('#productLang' + productId).val();
    console.log(productId + '--' + digitPrice + '--' + lowestPrice + '--' + productName);
    $('#notifyPriceAlert').modal('show');
    //Reset first
    $('#npaProductName').text('');
    $('#npaProductLang').text('');
    $('#npaProductLowestPrice').text('');
    $('#npaSubscriberEmail').val('');
    $('#npaLatestlaunch').prop("checked", true);
    $('#npaLatestupdate').prop("checked", true);
    $('#npaProductId').val('');
    $('#npaProductPrice').val('');
    //Now set variables on pop up
    $('#npaProductName').text(productName);
    $('#npaProductLang').val(productLang);
    $('#npaProductLowestPrice').text(lowestPrice);
    $('#npaProductId').val(productId);
    $('#npaProductPrice').val(digitPrice);

    /* GA tracking before Hit*/
    var eventLabel = productName;
    var eventLanguage = productLang;
    var eventActionType = 'click';
    var alertTitle = 'Price_Alert';
    hitGaForPriceALertAndNotify(eventLabel, eventLanguage, eventActionType, alertTitle);
}


/* 
 * **************************************************************************
 * Method Name      :   sendPriceAlertNotification
 * Description      :   To send price drop alert.
 * **************************************************************************
 */
function sendPriceAlertNotification() {
    var email = $('#npaSubscriberEmail').val();
    if (email == '') {
        alert('Please enter subscriber email.');
        return false;
    }
    var regex = /^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
    if (!regex.test(email)) {
        alert('Invalid email Id.');
        return false;
    }
    var productid = $('#npaProductId').val();
    var productprice = $('#npaProductPrice').val();
    var latestupdate = ($('#npaLatestupdate').is(':checked') ? '1' : '0');
    var latestlaunch = ($('#npaLatestlaunch').is(':checked') ? '1' : '0');
    var alerttype = '1';

    $.ajax({
        type: 'GET',
        url: digitApiUrl+'user/notification/save',
        dataType: '',
        data: {
            email: email,
            productid: productid,
            productprice: productprice,
            latestupdate: latestupdate,
            latestlaunch: latestlaunch,
            alerttype: alerttype,
        },
        beforeSend: function (request) {
            return request.setRequestHeader('X-CSRF-Token', $("meta[name='token']").attr('content'));
        },
        success: function (data) {
            if (data.success == true) {
                //Now update GA
                /* GA tracking before Hit*/
                var eventLabel = $('#npaProductName').text();
                var eventLanguage = $('#npaProductLang').val();
                var eventActionType = 'register';
                hitGaForPriceALertAndNotify(eventLabel, eventLanguage, eventActionType);
                $('#notifyPriceAlert').modal('hide');
                $('html, body').animate({
        scrollTop: $("#successAlertForSubscription").offset().top
    }, 2000);
                $('#successAlertForSubscription').modal('show');
                //alert(data.msg);
            } else if (data.success == false) {
                alert(data.msg);
            }

        },
        error: function (data) {
            alert('Sorry! We are unable to send price drop alerts. Please try again.');
        }

    });
}


/* 
 * **************************************************************************
 * Method Name      :   showProductAvailabilityNotifyAlert
 * Description      :   To open product availability alert popup and set/reset default values.
 * **************************************************************************
 */
function showProductAvailabilityNotifyAlert(productId, merchantId) {
    var productName = $('#productName' + productId).val();
    var productLang = $('#productLang' + productId).val();
    $('#notifyProductAvailability').modal('show');
    console.log(productId + '--' + merchantId);
    //Reset first
    $('#npavSubscriberEmail').val('');
    $('#npavLatestlaunch').prop("checked", true);
    $('#npavLatestupdate').prop("checked", true);
    $('#npavProductId').val('');
    $('#npavMerchantId').val('');
    $('#npavProductLang').val('');
    $('#npavProductName').val('');
    //Now set variables on pop up
    $('#npavProductId').val(productId);
    $('#npavMerchantId').val(merchantId);
    $('#npavProductLang').val(productLang);
    $('#npavProductName').val(productName);

    /* GA tracking before Hit*/
    var eventLabel = productName;
    var eventLanguage = productLang;
    var eventActionType = 'click';
    var alertTitle = 'Notify_Alert';
    hitGaForPriceALertAndNotify(eventLabel, eventLanguage, eventActionType, alertTitle);
}

/* 
 * **************************************************************************
 * Method Name      :   sendProductAvailabilityNotification
 * Description      :   To send product availability alert.
 * **************************************************************************
 */
function sendProductAvailabilityNotification() {

    var email = $('#npavSubscriberEmail').val();
    if (email == '') {
        alert('Please enter subscriber email.');
        return false;
    }

    var regex = /^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
    if (!regex.test(email)) {
        alert('Invalid email Id.');
        return false;
    }
    var productid = $('#npavProductId').val();
    var merchantid = $('#npavMerchantId').val();
    var latestupdate = ($('#npavLatestupdate').is(':checked') ? '1' : '0');
    var latestlaunch = ($('#npavLatestlaunch').is(':checked') ? '1' : '0');
    var alerttype = '0';
    $.ajax({
        type: 'GET',
        url: digitApiUrl+'user/notification/save',
        dataType: '',
        data: {
            email: email,
            productid: productid,
            merchantid: merchantid,
            latestupdate: latestupdate,
            latestlaunch: latestlaunch,
            alerttype: alerttype,
        },
        beforeSend: function (request) {
            return request.setRequestHeader('X-CSRF-Token', $("meta[name='token']").attr('content'));
        },
        success: function (data) {
            console.log(JSON.stringify(data));
            /* GA tracking before Hit*/
            var eventLabel = $('#npavProductName').val();
            var eventLanguage = $('#npavProductLang').val();
            var eventActionType = 'register';
            var alertTitle = 'Notify_Alert';
            hitGaForPriceALertAndNotify(eventLabel, eventLanguage, eventActionType, alertTitle);
            if (data.success == true) {
                $('#notifyProductAvailability').modal('hide');
                //alert(data.msg);
                $('#successAlertForSubscription').modal('show');
            } else if (data.success == false) {
                alert(data.msg);
            }

        },
        error: function (data) {
            alert('Sorry! We are unable to send price drop alerts. Please try again.');
        }

    });
}


/* 
 * **************************************************************************
 * Method Name      :   hitGaForPriceALertAndNotify
 * Description      :   This is to manage different GA events for price drop 
 *                      and product availability alerts.
 * **************************************************************************
 */
function hitGaForPriceALertAndNotify(eventLabel, eventLanguage, eventActionType, alertTitle)
{
    eventLanguage = LANGUAGE;
    if (deviceType == 'desktop') {
        if (eventLanguage == 'en') {
            var eventCategory = alertTitle + '_Desktop';
        } else {
            var eventCategory = alertTitle + '_Desktop_Ver';
        }
    } else if (deviceType == 'mobile') {
        if (eventLanguage == 'en') {
            var eventCategory = alertTitle + '_Desktop';
        } else {
            var eventCategory = alertTitle + '_Desktop_Ver';
        }
    } else if (deviceType == 'amp') {
        if (eventLanguage == 'en') {
            var eventCategory = alertTitle + '_AMP';
        } else {
            var eventCategory = alertTitle + '_AMP_Ver';
        }
    }

    var eventAction = alertTitle + '_' + eventLanguage;
    if (eventActionType == 'click') {
        eventAction = eventAction + '_Clicked';
    } else if (eventActionType == 'register') {
        eventAction = eventAction + '_Registered';
    }
    var dataJson = {hitType: 'event', eventCategory: eventCategory, eventAction: eventAction, eventLabel: eventLabel};
    console.log(dataJson);
    //var dataJson = {hitType: 'event', eventCategory: eventCategory, eventAction: 'Price-Alert_EN_Clicked/Price-Alert_EN_Registered', eventLabel: 'Asus Zenfone AR'};
    gaTrack(dataJson);
}

/* 
 * **************************************************************************
 * Method Name      :   gaTrack
 * Description      :   To send google analytics
 * **************************************************************************
 */
function gaTrack(dataJson) {
    ga('send', dataJson);
}



/* get Google tag manager code */
function getGTMCode() {
    if(deviceType === 'desktop' && LANGUAGE === 'en' )
        return 'GTM-NDN46D';
    if(deviceType === 'desktop' && LANGUAGE !== 'en')
        return 'GTM-59MGXPN';
    if(deviceType === 'mobile' && LANGUAGE === 'en')
        return 'GTM-N46KLS';
    if(deviceType === 'mobile' && LANGUAGE !== 'en')
        return 'GTM-M8FFQKW';
    return 'GTM-NDN46D';
}


function getEventTrackLink(section) {
    var eventTrackData = {
        "en": {
            "toptenpricelist": {
                "mobile": "Top10_Detail_Mapng_Tbl_Mobile",
                "desktop": "Top10_Detail_Mapng_Tbl_Desktop"
            },
            "hotdeal": {
                "mobile": "Top_10_HotDeal",
                "desktop": "Top_10_HotDeal"
            },
            "sponsored": {
                "mobile": "sponserod_product_mobile",
                "desktop": "sponserod_product_desktop"
            },
            "pricelist": {
                "mobile": "Price_list_mobile_product_page",
                "desktop": "Price_list_desktop_product_page"
            },
            "headersticky": {
                "mobile": "Header_sticky_mobile_product_page",
                "desktop": "Header_sticky_desktop_product_page"
            },
            "intext": {
                "desktop": "In_Text_link_desktop_news",
                "mobile": "In_Text_link_mob_news"
            },
            "article_sponsored": {
                "desktop": "sponserod_product_desktop",
                "mobile": "sponserod_product_mobile"
            },
            "atricle_hotdeal": {
                "desktop": "hot_deals_product_page",
                "mobile": "hot_deals_product_page"
            },
            "shopnow": {
                "desktop": "Shop_now_desktop_news_page",
                "mobile": "Shop_now_mob_news_page"
            },
            "review_pricelist": {
                "mobile": "Price_list_mobile_review_page",
                "desktop": "Price_list_desktop_review_page"
            },
            "review_sponsered": {
                "mobile": "sponserod_review_mobile",
                "desktop": "sponserod_review_desktop"
            },
            "review_hotdeal": {
                "mobile": "hot_deals_review_page",
                "desktop": "hot_deals_review_page"
            },
            "review_merchant_sticky": {
                "mobile": "merchant_sticky_review_mobile",
                "desktop": "merchant_sticky_review_desktop"
            },
            "below_img_link": {
                "desktop": "Below_img_link_desktop_slideshow",
                "mobile": "Below_img_link_mobile_slideshow"
            },
            "slideshow_hotdeal": {
                "mobile": "hot_deals_slideshow_page"
            },
            "slideshow_sponsered": {
                "desktop": "sponserod_slideshow_desktop",
                "mobile": "sponserod_slideshow_mobile"
            },
            "merchant_sticky": {
                "mobile": "header_sticky_mob_comp_page",
                "desktop": "header_sticky_desktop_comp_page"
            },
            "below_img": {
                "mobile": "below_product_image_mob_comp_page",
                "desktop": "below_product_image_desktop_comp_page"
            },
            "compare_sponsered": {
                "mobile": "sponserod__mob_comp_page",
                "desktop": "sponserod__desktop_comp_page"
            },
            "compare_hotdeal": {
                "mobile": "hot_deals_comp_page",
                "desktop": "hot_deals_comp_page"
            },
            "most_searched": {
                  "mobile": "most_search_amp_cat_page",
                  "desktop": "most_search_amp_cat_page"
            },
            "cat_sponsered": {
                "mobile": "sponserod__mob_cat_page",
                "desktop": "sponserod__desktop_cat_page"
            },
            "cat_hotdeal": {
                "mobile": "hot_deals_cat_page",
                "desktop": "hot_deals_cat_page"
            },
            "cont_type_mostsearched": {
                "mobile": "most_search_mob_content_type_page",
                "desktop": "most_search_desktop_content_type_page"
            },
            "cont_type_sponsered": {
                "mobile": "sponserod__mob_content_type_page",
                "desktop": "sponserod__desktop_content_type_page"
            },
            "cont_type_hotdeals": {
                "mobile": "hot_deals_content_type_page",
                "desktop": "hot_deals_content_type_page"
            },
            "mapping_brand": {
                "mobile": "mapping_mobile_brand_page",
                "desktop": "mapping_desktop_brand_page"
            },
            "brand_sponsered": {
                "mobile": "sponserod_mob_brand_page",
                "desktop": "sponserod_desktop_brand_page"
            },
            "brand_hotdeal": {
                "mobile": "hot_deals_brand_page",
                "desktop": "hot_deals_brand_page"
            },

            "hotdeal_price_detail": {
                "mobile": "price_detail_mob_hot_deal_page",
                "desktop": "price_detail_desktop_hot_deal_page"
},
            "plan_category": {
                "mobile": "Mobile_recharge_Plan_mobile",
                "desktop": "Mobile_recharge_Plan_Desktop"

            },
            "video_most_search": {
                "mobile": "most_search_mob_video_page",
                "desktop": "most_search_desktop_video_page"

            },
            "video_sponsered": {
                "mobile": "sponserod_mob_video_page",
                "desktop": "sponserod_desktop_video_page"

            },
            "video_hot_deals": {
                "mobile": "hot_deals_video_page",
                "desktop": "hot_deals_video_page"

            },
            "toptenlisting_sponsered": {
                "mobile": "sponserod_product_mobile",
                "desktop": "sponserod_product_desktop"

            },
            "toptenlisting_hot_deals": {
                "mobile": "Top_10_HotDeal",
                "desktop": "Top_10_HotDeal"

            },
            "product_all_price": {
              "mobile": "all_price_list_mob_product_page",
              "desktop": "all_price_list_desktop_product_page"
            },
            "defaultEvent": "hot_deals_product_page"
        },
        "vernac": {
            "toptenpricelist": {
                "mobile": "Top10_Detail_Mapng_Tbl_Mobile_Ver",
                "desktop": "Top10_Detail_Mapng_Tbl_Desktop_Ver"
            },
            "hotdeal": {
                "mobile": "Top_10_HotDeal_Ver",
                "desktop": "Top_10_HotDeal_Ver"
            },
            "sponsored": {
                "mobile": "sponserod_product_mobile_ver",
                "desktop": "sponserod_product_desktop_ver"
            },
            "pricelist": {
                "mobile": "Price_list_mobile_product_page_ver",
                "desktop": "Price_list_desktop_product_page_ver"
            },
            "headersticky": {
                "mobile": "Header_sticky_mobile_product_page_ver",
                "desktop": "Header_sticky_desktop_product_page_ver"
            },
            "intext": {
                "desktop": "In_Text_link_desktop_news_ver",
                "mobile": "In_Text_link_mob_news_ver"
            },
            "article_sponsored": {
                "desktop": "sponserod_product_desktop_ver",
                "mobile": "sponserod_product_mobile_ver"
            },
            "atricle_hotdeal": {
                "desktop": "hot_deals_product_page_ver",
                "mobile": "hot_deals_product_page_ver"
            },
            "shopnow": {
                "desktop": "Shop_now_desktop_news_page_ver",
                "mobile": "Shop_now_mob_news_page_ver"
            },
            "review_pricelist": {
                "mobile": "Price_list_mobile_review_page_ver",
                "desktop": "Price_list_desktop_review_page_ver"
            },
            "review_sponsered": {
                "mobile": "sponserod_review_mobile_ver",
                "desktop": "sponserod_review_desktop_ver"
            },
            "review_hotdeal": {
                "mobile": "hot_deals_review_page_ver",
                "desktop": "hot_deals_review_page_ver"
            },
            "review_merchant_sticky": {
                "mobile": "merchant_sticky_review_mobile_ver",
                "desktop": "merchant_sticky_review_desktop_ver"
            },
            "below_img_link": {
                "desktop": "Below_img_link_desktop_slideshow_ver",
                "mobile": "Below_img_link_mobile_slideshow_ver"
            },
            "slideshow_hotdeal": {
                "desktop": "hot_deals_slideshow_page_ver",
                "mobile": "hot_deals_slideshow_page_ver"
            },
            "slideshow_sponsered": {
                "desktop": "sponserod_slideshow_desktop_ver",
                "mobile": "sponserod_slideshow_mobile_ver"
            },
            "merchant_sticky": {
                "mobile": "header_sticky_mob_comp_page_ver",
                "desktop": "header_sticky_desktop_comp_page_ver"
            },
            "below_img": {
                "mobile": "below_product_image_mob_comp_page_ver",
                "desktop": "below_product_image_desktop_comp_page_ver"
            },
            "compare_sponsered": {
                "mobile": "sponserod__mob_comp_page_ver",
                "desktop": "sponserod__desktop_comp_page_ver"
            },
            "compare_hotdeal": {
                "mobile": "hot_deals_comp_page_ver",
                "desktop": "hot_deals_comp_page_ver"
            },
            "most_searched": {
                "mobile": "most_search_amp_cat_page_ver",
                "desktop": "most_search_amp_cat_page_ver"
            },
            "cat_sponsered": {
                "mobile": "sponserod__mob_cat_page_ver",
                "desktop": "sponserod__desktop_cat_page_ver"
            },
            "cat_hotdeal": {
                "mobile": "hot_deals_cat_page_ver",
                "desktop": "hot_deals_cat_page_ver"
            },
            "cont_type_mostsearched": {
                "mobile": "most_search_mob_content_type_page_ver",
                "desktop": "most_search_desktop_content_type_page_ver"
            },
            "cont_type_sponsered": {
                "mobile": "sponserod__mob_content_type_page_ver",
                "desktop": "sponserod__desktop_content_type_page_ver"
            },
            "cont_type_hotdeals": {
                "mobile": "hot_deals_content_type_page_ver",
                "desktop": "hot_deals_content_type_page_ver"
            },
            "mapping_brand": {
                "mobile": "mapping_amp_brand_page_ver",
                "desktop": "mapping_amp_brand_page_ver"
            },
            "brand_sponsered": {
                "mobile": "sponserod_mob_brand_page_ver",
                "desktop": "sponserod_desktop_brand_page_ver"
            },
            "brand_hotdeal": {
                "mobile": "hot_deals_brand_page_ver",
                "desktop": "hot_deals_brand_page_ver"
            },
            "hotdeal_price_detail": {
                "mobile": "price_detail_mob_hot_deal_page_ver",
                "desktop": "price_detail_desktop_hot_deal_page_ver"
            },
            "video_most_search": {
                "mobile": "most_search_mob_video_page_ver",
                "desktop": "most_search_desktop_video_page_ver"

            },
            "video_sponsered": {
                "mobile": "sponserod_mob_video_page_ver",
                "desktop": "sponserod_desktop_video_page_ver"

            },
            "video_hot_deals": {
                "mobile": "hot_deals_video_page_ver",
                "desktop": "hot_deals_video_page_ver"

            },
            "toptenlisting_sponsered": {
                "mobile": "sponserod_product_mobile_ver",
                "desktop": "sponserod_product_desktop_ver"

            },
            "toptenlisting_hot_deals": {
                "mobile": "Top_10_HotDeal_Ver",
                "desktop": "Top_10_HotDeal_Ver"

            },
            "product_all_price": {
              "mobile": "all_price_list_mob_product_page_ver",
              "desktop": "all_price_list_desktop_product_page_ver"
            },
            "defaultEvent": "hot_deals_product_page_ver"
        }
    };
    var generatedEventLink = '';
    if (LANGUAGE == 'en')
        generatedEventLink = (eventTrackData['en'][section] && eventTrackData['en'][section][deviceType]) ? eventTrackData['en'][section][deviceType] : eventTrackData['en']['defaultEvent'];
    else
        generatedEventLink = (eventTrackData['vernac'][section] && eventTrackData['vernac'][section][deviceType]) ? eventTrackData['vernac'][section][deviceType] : eventTrackData['vernac']['defaultEvent'];
    return generatedEventLink;
}


/* 
 * **************************************************************************
 * Method Name      :   merchantGaAffliateEvent
 * Description      :   This is to manage different GA events for buy now for 
 *                      different merchants.
 * **************************************************************************
 */
function merchantGaAffliateEvent(){
      console.log('test GA ');
      var merchant = $(this).attr('data-seller');
      var sellerUrl = $(this).attr('data-href');
      var productName = $(this).attr('product-name');
      var category = $(this).attr('category');
      var section = $(this).attr('section');
      var url = $(this).attr('url');
      var urlalias = $(this).attr('urlalias');
      var eventValue = $(this).attr('eventValue')?$(this).attr('eventValue'):0;

      var redirectUrl = getGenerateAffilateLink(merchant,category,section,url,urlalias);
      var eventLabel = productName;
      var alertTitle = getEventTrackLink(section);
      var eventAction = merchant;
      hitGaForBuyNow(eventLabel, alertTitle, eventAction,eventValue);
      if(current_route!='recharge' && current_route!='networkprovider' && current_route!='rechargesearchresult' && current_route!='rechargesearch')
      {
        window.open(redirectUrl, '_blank');
      }
      
  }

/* 
 * **************************************************************************
 * Method Name      :   hitGaForBuyNow
 * Description      :   This is to manage different GA events for buy now for
 *                      different merchants.
 * **************************************************************************
 */
function hitGaForBuyNow(eventLabel,alertTitle,eventAction,eventValue){
  var dataJson = {hitType: 'event', eventCategory: alertTitle, eventAction: eventAction, eventLabel: eventLabel,eventValue:eventValue};
    gaTrack(dataJson);
}

/*
 * **************************************************************************
 * Method Name      :   headerAd
 * Description      :   To generate video frame
 * **************************************************************************
 */
function headerAd(){
    $('#skinerAd, #display_headerAd').html('');
    if(deviceType == 'desktop' ){
        $('#display_headerAd').html('<div class="center-left" id="headerAd"></div><div class="center-right" id="small_leaderboard"></div>');
        $('#skinerAd').html('<div class="takeover-catfish"> <div class="left-Add" id="left_ad"></div> <div class="right-Add" id="right_ad"></div> </div>');
    }else{
      $('#display_headerAd').html('<div class="col-xl" id="headerAd"></div>');
      $('#skinerAd').html('');
    }
}
function initComparisons() { return true;}


/* 
 * **************************************************************************
 * Method Name      :   loadtop10VideoSection
 * Description      :   To generate video frame
 * **************************************************************************
 */
function loadtop10VideoSection()
{
    if ($.isEmptyObject(videoData)) {
        return false;
    } else {
        var videoId = videoData.video_id;
        var provider = videoData.provider;
        var videoUrl = videoData.url;
        var playerHtml = '';
        var playerPopHtml = '';
        if (provider == 'youtube') {
            playerHtml = '<iframe class="embed-responsive-item" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" src="https://www.youtube.com/embed/' + videoUrl + '" width="100%" height="100%" frameborder="0"></iframe>';
        } 
        $('#top10VideoSection').html('');
        $('#top10VideoSection').html(playerHtml);
    }
}

/* 
 * **************************************************************************
 * Method Name      :   top10VideoThumbnailGallery
 * Description      :   To generate video frame
 * **************************************************************************
 */
function top10VideoThumbnailGallery()
{
    if ($.isEmptyObject(jsonPopupData)) {
        return false;
    } else {
        jsonPopupData.forEach(function(value){
        var videoId = value.video_id;
        var provider = value.provider;
        var videoUrl = value.url;
        var playerHtml = '';
        var playerPopHtml = '';
        if (provider == 'youtube') {
            playerHtml = '<iframe class="embed-responsive-item" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" src="https://www.youtube.com/embed/' + videoUrl + '" width="100%" height="100%" frameborder="0"></iframe>';
        } 
        var hasVideoSection = '#top10VideoThumbnailGallery_'+videoId;
        $(hasVideoSection).html('');
        $(hasVideoSection).html(playerHtml);
        });
    }
}

/* 
 * **************************************************************************
 * Method Name      :   setFirebaseConfiguration
 * Description      :   It is use to set the firebase configration
 * **************************************************************************
 */
function setFirebaseConfiguration() {
    // Set the configuration for your app
    var config = {
      apiKey: "AIzaSyDPNNYqX_DtkPlYyi9_4shOx8_wZjHbnnY",
      authDomain: "digit-7d163.firebaseapp.com",
      databaseURL: "https://digit-7d163.firebaseio.com",
    };

    if (!firebase.apps.length) {
        firebase.initializeApp(config);
    }

     // firebase.initializeApp(config);
    // Get a reference to the database service
     var database = firebase.database();
     return database;
   }

 /* 
 * **************************************************************************
 * Method Name      :   createMerchantListWithHtml
 * Description      :   It is use to create Merchant List With Html
 * **************************************************************************
 */
function createMerchantListWithHtml() {
   var database = setFirebaseConfiguration();
  var len=  $('.merchantdatalist').length-1;
  var toptenMechantData='';
  var imagepath = 'https://www.digit.in/images/merchantLogos';
   $('.merchantdatalist').each(function (index) {
     var divId = this.id;
    if(typeof divId !== "undefined" && divId!= '' ){
     var productId = $('#'+divId).attr('data-proid');
     var section = $('#'+divId).attr('section');

    if(productId!='null' && productId>0){
    database.ref('/merchantproducts/' + productId).once('value').then(function(snapshot) {
        var mdata = snapshot.val();
        if(mdata!=null && mdata.merchants!=null){
            toptenMechantData+='<table class="table"><tbody>';
            var i=1
            mdata.merchants.forEach(function(value){
            var seller_url_alias = (typeof value.seller_url_alias !== typeof undefined && value.seller_url_alias !== false) ? value.seller_url_alias : '';
            if (deviceType == 'desktop') {
              var imgurllogo = merchantLogo[value.seller].bq;
            } else {
              var imgurllogo = merchantLogo[value.seller].small;
            }
            if(i==1){    
            var sammaryPrice  = value.price; 
            $('td.smprice').eq(index).html('&#x20b9;'+sammaryPrice); 
            $('td.smmerchant').eq(index).html(value.seller); 
            } 
            toptenMechantData+='<tr rel="nofollow" id="buyLink" data-seller="'+value.seller+'" product-name="'+value.merchant_productname+'" category="'+value.category_id+'" section="'+ section +'" url="'+value.seller_url +'" urlalias="'+seller_url_alias +'" eventValue="'+i+'" class="merchantBuyBtn" ><td><img src="'+imagepath+'/'+imgurllogo +'" alt='+ value.seller +'></td>\n\
            <td><strong class="greentext">Available</strong></td>\n\
            <td> <strong><i class="fa fa-inr"></i>'+value.price +'</strong></td>\n\
            <td ><button class="button_buy" alt="Buy now on '+value.seller+'">Buy Now</button></td></tr>';
         i++;    
        });
         toptenMechantData+='</tr></tbody></table>'; 
        }
        $('#'+divId).html(toptenMechantData);
        toptenMechantData='';
        i='';
        if(index==len){
           $('.merchantBuyBtn').on('click',merchantGaAffliateEvent);
        }
    });
  }
}
   }); 
 // $('.merchantBuyBtn').on('click',merchantGaAffliateEvent);
}  

if ($(".merchantdatalist").is(":visible")) {
createMerchantListWithHtml();
}


/* 
 * **************************************************************************
 * Method Name      :   createHotDealListWithHtml
 * Description      :   It is use to create HotDeal List With Html
 * **************************************************************************
 */
function createHotDealListWithHtml() {
    var database = setFirebaseConfiguration();
    var hotdealData='';
    var getcatId = $('#hotdealdata').attr('data-catid');
    var catId = (typeof getcatId !== typeof undefined && getcatId !== false) ? getcatId : 32;
    var imagepath = 'https://www.digit.in/images/merchantLogos';
    var sponserId = 'cat_'+catId;
    var popularId = 'popular_'+catId;
    var getsponserSection = $('#hotdealdata').attr('data-sponsection');
    var sponserSection = (typeof getsponserSection !== typeof undefined && getsponserSection !== false) ? getsponserSection : 'sponsored';
    var gethotdealSection = $('#hotdealdata').attr('data-hotdeal');
    var hotdealSection = (typeof gethotdealSection !== typeof undefined && gethotdealSection !== false) ? gethotdealSection : 'hotdeal';

    //GET SPONSERED PRODUCTS: START
    database.ref("/hotdealmerchants/merchants").orderByChild("category_id").equalTo(sponserId).limitToFirst(1).once('value').then(function(snapshot) {
        var mdata = snapshot.val();
         if(mdata!=null){
            // console.table(mdata);
                for(var key in mdata) {
                    var value= mdata[key];
                    section = sponserSection;
                var seller_url_alias = (typeof value.seller_url_alias !== typeof undefined && value.seller_url_alias !== false) ? value.seller_url_alias : '';
                var i=1;
                hotdealData+=`<div class="Tag-Sponcered">Sponsored</div>`;
                hotdealData+=`<div class="hot_detail_row Sponcered_BG" rel="nofollow sponsored" data-seller="${value.seller}" product-name="${value.merchant_productname}" category="${catId}" section="${section}" url="${value.seller_url}" urlalias="${seller_url_alias}" eventValue="${i}">
                      <div class="hot_image">
                         <img src="${ value.merchant_product_image_url }" alt="${value.seller}"> 
                      </div>
                   <div class="hot-detail">
                         <div class="Product-name">${value.merchant_productname}</div>
                      <div class="Price-Deal">
                         <span class="rupees-style">₹ ${value.price}<span class="line"> |</span></span>
                         <span class="img-seller">
                              <img src="${imagepath}/${ merchantLogo[value.seller].small }" alt="${value.seller}">
                         </span>
                      </div>
                   </div>
                  <div class="hot-buy-now PT10">
                          <button type="primary" class="hot-deal-by pull-right" alt="Buy now on ${value.seller}">Buy Now</button>
                      <div class="clearfix"></div>
                   </div>
                 </div>`;
        }
         }
    });

//GET SPONSERED PRODUCTS: END AND GET HOTDEAL PRODUCTS

     database.ref("/hotdealmerchants/merchants").orderByChild("category_id").equalTo(popularId).limitToFirst(4).once('value').then(function(snapshot) {
        var hotdata = snapshot.val();
         if(hotdata!=null){
            var i=2;
            var section = hotdealSection;
               for(var key in hotdata) {
                var value= hotdata[key];
                var seller_url_alias = (typeof value.seller_url_alias !== typeof undefined && value.seller_url_alias !== false) ? value.seller_url_alias : '';

                hotdealData+=`<div class="hot_detail_row" rel="nofollow sponsored" data-seller="${value.seller}" product-name="${value.merchant_productname}" category="${catId}" section="${section}" url="${value.seller_url}" urlalias="${seller_url_alias}" eventValue="${i}">
                      <div class="hot_image">
                         <img src="${ value.merchant_product_image_url }" alt="${value.seller}"> 
                      </div>
                   <div class="hot-detail">
                         <div class="Product-name">${value.merchant_productname}</div>
                      <div class="Price-Deal">
                         <span class="rupees-style">₹ ${value.price}<span class="line"> |</span></span>
                         <span class="img-seller">
                              <img src="${imagepath}/${ merchantLogo[value.seller].small }" alt="${value.seller}">
                         </span>
                      </div>
                   </div>
                  <div class="hot-buy-now PT10">
                          <button type="primary" class="hot-deal-by pull-right" alt="Buy now on ${value.seller}">Buy Now</button>
                      <div class="clearfix"></div>
                   </div>
                 </div>`;
          i++;  
        }
         }
         i='';  
         if(hotdealData) {
         $('.hot_deals').html(hotdealData);
         }
         $('div.hot_detail_row').on('click',merchantGaAffliateEvent);
    });

 }  
 
 createHotDealListWithHtml();
 

/************** STOP: Copy Old Js (common.js) File Content  for product **********/

/** GA product scroll event */
if (current_route && (current_route == 'nonampproduct')) {
    var prdEventPos = 0;
    var gaJson = {
        hitType: "event",
        eventCategory: `Product_${LANGUAGE}_Scroll`,
        eventAction: "NonAMPScroll",
        eventValue: 1
    };
    if (current_route && (current_route == 'nonampproduct')) {
        var prdGaFirst = true;
        var prdGaLast = true;
        $(window).on("scroll", function () {
            if (window.pageYOffset > 0 && prdGaFirst) {
                prdGaFirst = false;
                gaJson.eventLabel = 'Start Scroll';
                ga('send', gaJson);
                console.log(gaJson.eventLabel,'anp');
            }
            setActiveProductGA();
            if ($('div.jumbotron.grey-bg').is(":visible") && (window.pageYOffset + window.innerHeight) > $('div.jumbotron.grey-bg').offset().top && prdGaLast) {
                prdGaLast = false;
                gaJson.eventLabel = 'End Scroll';
                ga('send', gaJson);
                console.log(gaJson.eventLabel,'anp');
            }
        });
    }
}

function setActiveProductGA() {
    currentProPos = window.pageYOffset + window.innerHeight - 80;
    $(".head-gaevent").each(function (index) {
        let gaTop = $(this).offset().top;
        let gaBottom = gaTop + $(this).height();

        if (currentProPos >= gaTop && currentProPos <= gaBottom) {
            $('.head-gaevent').removeClass("active");
            $(this).addClass("active");
            gaJson.eventLabel = $('.head-gaevent.active').data("event_label");
            if (prdEventPos != $('.head-gaevent.active').data("index")) {
                ga('send', gaJson);
                console.log(gaJson.eventLabel,'anp');
                prdEventPos = $('.head-gaevent.active').data("index");
            }
        }
    });
}
/** GA product scroll event */

/** GA Topten scroll event:Start */

if(current_route && (current_route == 'toptenDetail' || current_route == 'toptenDetailVrnc')){

    var top10First = true;
    var top10Last = true;
    var topten_cat_new = $(".TopNumbeHeading:first").data("cat");
    $(window).on("scroll", function () {
    console.log(topten_cat_new);
    if(window.pageYOffset > 0 && top10First){
    
    top10First = false;
    ga('send', { hitType: 'event', eventCategory: topten_cat_new, eventAction: 'NonAMPScroll', eventLabel: 'Start Scroll', eventValue: 1 });
    console.log(topten_cat_new, 'Start Scroll NonAMPScroll');
    console.log('Anp Fisrt');
    }
    setActiveTopten();
    console.log((window.pageYOffset + window.innerHeight), '==== Anp ==', $('.footer-nav').offset().top);
    if((window.pageYOffset + window.innerHeight) > $('.footer-nav').offset().top && top10Last){
    
    top10Last = false;
    ga('send', { hitType: 'event', eventCategory: topten_cat_new, eventAction: 'NonAMPScroll', eventLabel: 'End Scroll', eventValue: 1 });
    console.log(topten_cat_new, 'End Scroll NonAMPScroll');
    console.log('Anp Last');
    }
    });
}

var topten_pos = 0;
function setActiveTopten() {
    currentPosition = window.pageYOffset + window.innerHeight - 80;
    $(".TopNumbeHeading").each(function (index) {
    let toptenTop = $(this).offset().top;
    let toptenBottom = toptenTop + $(this).height();
    if ( currentPosition >= toptenTop && currentPosition <= toptenBottom ){
        $('div.TopNumbeHeading').removeClass("active");
        $(this).addClass("active");
        var topten_cat = $(this).data("cat");
        var topten_eventaction = $(this).data("eventaction");
        
        if(topten_pos != $(this).data("index")){
        var topten_proname = $(this).data("proname");
        ga('send', { hitType: 'event', eventCategory: topten_cat, eventAction: topten_eventaction, eventLabel: topten_proname, eventValue: 1 });
        console.log(topten_pos+' '+topten_cat+' '+topten_proname+' '+topten_eventaction);
        topten_pos = $(this).data("index");
        }
        
    }
  });
}

/** GA Topten scroll event:End */

$(window).scroll(function() {    
    var scroll = $(window).scrollTop();
     //console.log(scroll);
    if (scroll >=750) {
        //console.log('a');
        $(".For-desktopsticky").addClass("sticky");
    } else {
        //console.log('a');
        $(".For-desktopsticky").removeClass("sticky");
    }
});

$(window).scroll(function() {    
    var scroll = $(window).scrollTop();
     //console.log(scroll);
    if (scroll >=750) {
        //console.log('a');
        $(".Merchant-sticky").addClass("Fixed-merchant");
    } else {
        //console.log('a');
        $(".Merchant-sticky").removeClass("Fixed-merchant");
    }
});
/** User Review page mobile section fixes */
$(document).ready(function(){
    if(deviceType === 'mobile' && typeof is_review_detail !== 'undefined' && is_review_detail === 1  ){
      $('div.Header, div.navbar-holder, div.center-add, div.jumbotron.grey-bg').remove();
      $("div#StikyHeader").removeAttr('id');
      let intHtl = $( "div.Sticky-menu" );
      $(intHtl).insertBefore('div.Center-block');
       $('div.Center-block').css("margin-top", "65px");
 
    }

    $('#myTab').on('shown.bs.modal', function () {
      updateImageSrc();
    })
});


$('.For-desktopsticky li a').click(function(){

var hash = $(this).attr('href');
$(".stmenu").removeClass("selected");

$(this).addClass("selected");

console.log(hash);
});

$(".close-merchant").click(function() {
  $('.Merchant-sticky').remove();
});
